<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakeBot - Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f7f3ea 0%, #f0e2cd 100%);
            min-height: 100vh; color: #40342b;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header {
            background: linear-gradient(135deg, #F5DEB3 0%, #D4A574 100%);
            padding: 20px; border-radius: 12px; margin-bottom: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
        }
        .header h1 { color: #5c3b1e; text-align: center; font-size: 2.3em; margin-bottom: 8px; }
        .nav { display: flex; justify-content: center; gap: 12px; flex-wrap: wrap; }
        .nav a { background: #8B4513; color: white; padding: 8px 16px; text-decoration: none; border-radius: 6px; transition: background 0.25s; }
        .nav a:hover, .nav a.active { background: #A0522D; }
        .tab-nav { display: flex; flex-wrap: wrap; gap: 6px; border-bottom: 2px solid #D4A574; margin: 10px 0 16px; }
        .tab-btn { background: #f2e8d8; color: #5c3b1e; border: 1px solid #d4a574; padding: 10px 14px; border-radius: 8px 8px 0 0; cursor: pointer; }
        .tab-btn.active { background: #D4A574; color: white; border-color: #c28b53; }
        .card { background: #fffdf8; border-radius: 12px; padding: 18px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .card h2 { color: #5c3b1e; margin-bottom: 12px; font-size: 1.4em; }
        .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #6b4b2f; }
        .form-group input, .form-group select {
            width: 100%; padding: 10px; border: 2px solid #D4A574; border-radius: 8px; font-size: 15px; background: #fffaf1; color: #40342b;
        }
        .btn { background: #8B4513; color: white; padding: 10px 16px; border: none; border-radius: 8px; cursor: pointer; }
        .btn.secondary { background: #D4A574; }
        .btn.danger { background: #C0392B; }
        .small { font-size: 0.9em; color: #6b4b2f; opacity: 0.9; }
        .status-indicator { text-align: center; padding: 12px; border-radius: 8px; font-weight: bold; }
        .status-stopped { background: #eee2d3; color: #6b4b2f; }
        .status-running { background: #e3f2d9; color: #2d6a2d; }
        .status-error { background: #f9d6d1; color: #a13528; }
        .message { padding: 10px; margin: 10px 0; border-radius: 8px; display: none; }
        .message.success { background: #e3f2d9; color: #2d6a2d; }
        .message.error { background: #f9d6d1; color: #a13528; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        code.inline { background:#f5e9d9; padding:2px 6px; border-radius:4px; }
        ul { margin-left: 18px; }
        ul li { margin: 6px 0; }
        table { border-collapse: collapse; width: 100%; }
        thead th, tbody td { padding: 8px; border-bottom: 1px solid #edd8bf; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>BakeBot Manager</h1>
            <nav class="nav">
                <a href="/" class="active">Dashboard</a>
                <a href="/logs">Logs</a>
                <a href="/users">Users</a>
                <a href="/games">Games</a>
                <a href="/shop">Shop</a>
                <a href="/oauth-wizard">OAuth Wizard</a>
            </nav>
        </div>

        <div class="tab-nav">
            <button class="tab-btn active" data-tab="tab-control">Control</button>
            <button class="tab-btn" data-tab="tab-config">Configuration</button>
            <button class="tab-btn" data-tab="tab-network">Network</button>
            <button class="tab-btn" data-tab="tab-eventsub">EventSub</button>
            <button class="tab-btn" data-tab="tab-recipes">Recipes</button>
        </div>

        <!-- Control Tab -->
        <div id="tab-control" class="tab-content active">
            <div class="card">
                <h2>Bot Control</h2>
                <div class="row" style="justify-content:center; gap:10px;">
                    <button id="start-btn" class="btn">Start Bot</button>
                    <button id="stop-btn" class="btn danger" disabled>Stop Bot</button>
                    <button id="leaderboard-btn" class="btn secondary">Open Leaderboard</button>
                </div>
                <div id="status" class="status-indicator status-{{ status }}" style="margin-top:12px;">
                    <span>Bot {{ status.title() }}</span>
                </div>
            </div>
            <div class="card">
                <h2>Quick Links</h2>
                <div class="row" style="gap:8px;">
                    <a class="btn secondary quick-link" data-action="open-setup" href="/docs/SETUP.md" target="_blank">Setup Guide</a>
                    <a class="btn secondary quick-link" data-action="open-port-forwarding" href="/docs/PORT_FORWARDING.md" target="_blank">Port Forwarding</a>
                    <a class="btn secondary quick-link" data-action="open-eventsub" href="/docs/EVENTSUB.md" target="_blank">EventSub Guide</a>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="tab-config" class="tab-content">
            <div class="card">
                <h2>Configuration</h2>
                <form id="config-form">
                    <div class="form-group">
                        <label for="token">Twitch OAuth Token</label>
                        <div class="row" style="gap:8px; align-items:center;">
                            <input type="password" id="token" name="TWITCH_TOKEN" value="{{ env_vars.TWITCH_TOKEN }}" placeholder="oauth:xxxx" style="flex:1;">
                            <button type="button" class="btn secondary" id="btn-show-token">Show</button>
                            <a class="btn" href="/oauth-wizard">Get Token</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group" style="flex:1; min-width:180px;">
                            <label for="client_id">Twitch Client ID</label>
                            <input type="text" id="client_id" name="TWITCH_CLIENT_ID" value="{{ env_vars.TWITCH_CLIENT_ID }}">
                        </div>
                        <div class="form-group" style="flex:1; min-width:180px;">
                            <label for="channel">Twitch Channel</label>
                            <input type="text" id="channel" name="TWITCH_CHANNEL" value="{{ env_vars.TWITCH_CHANNEL }}" placeholder="yourchannel">
                        </div>
                        <div class="form-group" style="flex:1; min-width:120px;">
                            <label for="prefix">Command Prefix</label>
                            <input type="text" id="prefix" name="PREFIX" value="{{ env_vars.PREFIX }}">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group" style="flex:1; min-width:160px;">
                            <label for="web_host">Web Host</label>
                            <input type="text" id="web_host" name="WEB_HOST" value="{{ env_vars.WEB_HOST }}" placeholder="0.0.0.0">
                            <div class="small">Use 0.0.0.0 for LAN/public</div>
                        </div>
                        <div class="form-group" style="flex:1; min-width:120px;">
                            <label for="web_port">Web Port</label>
                            <input type="number" id="web_port" name="WEB_PORT" value="{{ env_vars.WEB_PORT }}" placeholder="8080">
                        </div>
                        <div class="form-group" style="flex:2; min-width:220px;">
                            <label for="public_base_url">Public Base URL (optional)</label>
                            <input type="text" id="public_base_url" name="PUBLIC_BASE_URL" value="{{ env_vars.PUBLIC_BASE_URL }}" placeholder="https://yourdomain.example">
                            <div class="small">Used for public links in chat</div>
                        </div>
                    </div>
                    <button type="submit" class="btn">Save Configuration</button>
                </form>
            </div>
        </div>

        <!-- Network Tab -->
        <div id="tab-network" class="tab-content">
            <div class="card">
                <h2>Network & Sharing</h2>
                <div class="row" style="gap:10px; align-items:center;">
                    <div class="form-group" style="min-width:180px;">
                        <label>Local IPv4</label>
                        <input id="local-ip" type="text" readonly>
                    </div>
                    <button class="btn" id="btn-refresh-ip">Refresh</button>
                    <span class="small">Use this for router port forwarding (Internal IP)</span>
                </div>
                <div class="row" style="gap:10px; align-items:center; margin-top:8px;">
                    <div class="form-group" style="min-width:180px;">
                        <label>Public IP</label>
                        <input id="public-ip" type="text" readonly>
                    </div>
                    <button class="btn" id="btn-refresh-public-ip">Refresh</button>
                    <button class="btn secondary" id="btn-set-public-url">Set as PUBLIC_BASE_URL</button>
                </div>
                <div class="row" style="gap:10px; align-items:center; margin-top:8px;">
                    <div class="form-group" style="flex:1; min-width:260px;">
                        <label>Public Leaderboard Link</label>
                        <input id="public-leaderboard-link" type="text" readonly>
                    </div>
                    <button class="btn" id="btn-copy-leaderboard-link">Copy</button>
                </div>
            </div>
            <div class="card">
                <h2>Port Forwarding</h2>
                <ul>
                    <li>Forward <code class="inline">WEB_PORT</code> (default <code class="inline">8080</code>) to your PC's <strong>Local IPv4</strong>.</li>
                    <li>Protocol: <strong>TCP</strong>. Allow through OS firewall when prompted.</li>
                    <li>Test public: <code class="inline">http://YOUR_PUBLIC_IP:WEB_PORT/leaderboard</code></li>
                    <li>Alternatively use a tunnel (ngrok/cloudflared) and set <code class="inline">PUBLIC_BASE_URL</code>.</li>
                </ul>
                <div class="row" style="gap:8px; margin-top:6px;">
                    <a class="btn secondary" href="/docs/PORT_FORWARDING.md" target="_blank">Open Guide</a>
                    <a class="btn secondary" href="/docs/WEB.md" target="_blank">Web/Tunnels</a>
                </div>
            </div>
        </div>

        <!-- EventSub Tab -->
        <div id="tab-eventsub" class="tab-content">
            <div class="card">
                <h2>EventSub (Channel Points) - Step by Step</h2>
                <ol style="margin-left:18px;">
                    <li>Enable EventSub and set a long random secret.</li>
                    <li>Expose your EventSub listener with HTTPS (tunnel or reverse proxy).</li>
                    <li>Start the bot (listener runs with the bot).</li>
                    <li>Create subscription in Twitch console: <code class="inline">channel.channel_points_custom_reward_redemption.add</code>.</li>
                    <li>Use the Callback URL below in your subscription.</li>
                </ol>
                <form id="eventsub-form" style="margin-top:10px;">
                    <div class="row">
                        <div class="form-group" style="min-width:160px;">
                            <label>Enable</label>
                            <select id="ev_enable" name="ENABLE_EVENTSUB">
                                <option value="false" {{ 'selected' if env_vars.ENABLE_EVENTSUB|lower != 'true' else '' }}>Disabled</option>
                                <option value="true" {{ 'selected' if env_vars.ENABLE_EVENTSUB|lower == 'true' else '' }}>Enabled</option>
                            </select>
                        </div>
                        <div class="form-group" style="min-width:140px;">
                            <label for="ev_port">EVENTSUB_PORT</label>
                            <input type="number" id="ev_port" name="EVENTSUB_PORT" value="{{ env_vars.EVENTSUB_PORT }}" placeholder="8081">
                        </div>
                        <div class="form-group" style="flex:1; min-width:220px;">
                            <label for="ev_secret">EVENTSUB_SECRET</label>
                            <input type="text" id="ev_secret" name="EVENTSUB_SECRET" value="{{ env_vars.EVENTSUB_SECRET }}" placeholder="choose-a-long-random-secret">
                        </div>
                    </div>
                    <div class="row" style="margin-top:8px; align-items:center;">
                        <div class="form-group" style="flex:1; min-width:280px;">
                            <label>Callback URL</label>
                            <input type="text" id="ev_callback" readonly placeholder="Set PUBLIC_BASE_URL in Configuration tab">
                            <div class="small">Formula: PUBLIC_BASE_URL + /eventsub (must be HTTPS)</div>
                        </div>
                        <button type="button" class="btn" id="btn-copy-callback">Copy</button>
                        <a class="btn secondary" href="https://dev.twitch.tv/console/eventsub" target="_blank">Open Twitch EventSub</a>
                    </div>
                    <div class="row" style="gap:8px; margin-top:8px;">
                        <button type="submit" class="btn">Save EventSub</button>
                        <a class="btn secondary" href="/docs/EVENTSUB.md" target="_blank">Full Guide</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Recipes Tab -->
        <div id="tab-recipes" class="tab-content">
            <div class="card">
                <h2>Recipes Manager</h2>
                <div class="row" style="gap:8px; align-items:flex-end;">
                    <div class="form-group" style="flex:2; min-width:200px;">
                        <label>Title</label>
                        <input id="rc_title" placeholder="e.g., Classic Chocolate Chip Cookies">
                    </div>
                    <div class="form-group" style="flex:2; min-width:220px;">
                        <label>URL (optional)</label>
                        <input id="rc_url" placeholder="https://...">
                    </div>
                    <div class="form-group" style="flex:3; min-width:260px;">
                        <label>Description (optional)</label>
                        <input id="rc_desc" placeholder="Short description">
                    </div>
                    <div class="form-group" style="width:110px;">
                        <label>Order</label>
                        <input id="rc_ord" type="number" value="0">
                    </div>
                    <div class="form-group" style="width:140px;">
                        <label>Visible</label>
                        <select id="rc_visible"><option value="true">Yes</option><option value="false">No</option></select>
                    </div>
                    <button class="btn secondary" id="rc_add">Add</button>
                </div>
                <div class="row" style="margin-top:10px; align-items:flex-start; gap:10px;">
                    <div class="form-group" style="flex:1; min-width:260px;">
                        <label>Bulk Import (JSON array or lines: Title|URL|Description)</label>
                        <textarea id="rc_bulk" style="width:100%; height:120px; padding:10px; border:2px solid #D4A574; border-radius:8px; background:#fffaf1;"></textarea>
                        <div class="row" style="gap:8px; margin-top:6px;">
                            <button class="btn" id="rc_bulk_btn">Import</button>
                            <button class="btn secondary" id="rc_bulk_demo">Fill Demo</button>
                        </div>
                    </div>
                </div>
                <div style="margin-top:12px;">
                    <table id="rc_table">
                        <thead>
                            <tr>
                                <th style="text-align:left;">Title</th>
                                <th style="text-align:left;">URL</th>
                                <th style="text-align:left;">Description</th>
                                <th>Visible</th>
                                <th>Order</th>
                                <th style="width:160px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="message" class="message"></div>
    </div>

    <script>
        // Tabs
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const target = btn.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(target).classList.add('active');
                if (target === 'tab-network') { loadNetwork(); }
                if (target === 'tab-eventsub') { updateCallback(); }
                if (target === 'tab-recipes') { loadRecipes(); }
            });
        });

        // Log quick link clicks without blocking navigation
        document.querySelectorAll('a.quick-link').forEach(a => {
            a.addEventListener('click', () => {
                const payload = JSON.stringify({ action: a.dataset.action || 'quick-link', href: a.href });
                try { navigator.sendBeacon('/api/log-ui', new Blob([payload], { type: 'application/json' })); } catch {}
            });
        });

        // Socket status
        const socket = io();
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const statusEl = document.getElementById('status');
        const messageEl = document.getElementById('message');
        socket.on('status_update', function(data) {
            statusEl.className = `status-indicator status-${data.status}`;
            statusEl.innerHTML = `<span>${data.message}</span>`;
            startBtn.disabled = (data.status === 'running');
            stopBtn.disabled = (data.status === 'stopped');
        });

        function showMessage(text, type = 'success') {
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            setTimeout(() => messageEl.style.display = 'none', 4000);
        }

        // Save config
        document.getElementById('config-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const data = Object.fromEntries(new FormData(e.target).entries());
            try {
                const res = await fetch('/api/save-config', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)});
                const out = await res.json();
                showMessage(out.message, out.success ? 'success' : 'error');
                updateCallback();
                loadNetwork();
            } catch (err) { showMessage('Error: ' + err.message, 'error'); }
        });

        // Bot control
        startBtn.addEventListener('click', async function(){ const res = await fetch('/api/start-bot', { method:'POST' }); const out = await res.json(); showMessage(out.message, out.success?'success':'error'); });
        stopBtn.addEventListener('click', async function(){ const res = await fetch('/api/stop-bot', { method:'POST' }); const out = await res.json(); showMessage(out.message, out.success?'success':'error'); });
        document.getElementById('leaderboard-btn').addEventListener('click', async function(){ const res = await fetch('/api/open-leaderboard', { method:'POST' }); const out = await res.json(); showMessage(out.message, out.success?'success':'error'); });

        // Token helpers
        document.getElementById('btn-show-token').addEventListener('click', function(){ const el = document.getElementById('token'); if (el.type==='password'){ el.type='text'; this.textContent='Hide'; } else { el.type='password'; this.textContent='Show'; } });

        // Network helpers
        async function loadNetwork(){ await loadLocalIP(); await loadPublicIP(); updateLinks(); }
        async function loadLocalIP(){ try{ const r = await fetch('/api/network-info'); const d = await r.json(); document.getElementById('local-ip').value = d.local_ipv4 || ''; }catch{} }
        async function loadPublicIP(){ try{ const r = await fetch('/api/public-ip'); const d = await r.json(); document.getElementById('public-ip').value = d.public_ip || 'Not found'; }catch{} }
        function updateLinks(){ const ip = document.getElementById('public-ip').value; const port = document.getElementById('web_port').value || '8080'; const url = (ip && ip!=='Not found') ? `http://${ip}:${port}/leaderboard` : ''; document.getElementById('public-leaderboard-link').value = url; }
        document.getElementById('btn-refresh-ip').addEventListener('click', loadLocalIP);
        document.getElementById('btn-refresh-public-ip').addEventListener('click', loadPublicIP);
        document.getElementById('web_port').addEventListener('input', updateLinks);
        document.getElementById('btn-copy-leaderboard-link').addEventListener('click', function(){ const i=document.getElementById('public-leaderboard-link'); i.select(); document.execCommand('copy'); showMessage('Copied!', 'success'); });
        document.getElementById('btn-set-public-url').addEventListener('click', function(){ const ip = document.getElementById('public-ip').value; const port = document.getElementById('web_port').value || '8080'; if (ip && ip!=='Not found'){ document.getElementById('public_base_url').value = `http://${ip}:${port}`; showMessage('Set PUBLIC_BASE_URL. Click Save to persist.', 'success'); updateCallback(); } });

        // EventSub helpers
        function updateCallback(){ const base = document.getElementById('public_base_url').value.trim(); const cb = base ? `${base.replace(/\/$/, '')}/eventsub` : ''; const input = document.getElementById('ev_callback'); if (input) input.value = cb; }
        document.getElementById('btn-copy-callback').addEventListener('click', function(){ const i=document.getElementById('ev_callback'); i.select(); document.execCommand('copy'); showMessage('Copied!', 'success'); });
        document.getElementById('eventsub-form').addEventListener('submit', async function(e){ e.preventDefault(); const data = { ENABLE_EVENTSUB: document.getElementById('ev_enable').value, EVENTSUB_PORT: document.getElementById('ev_port').value, EVENTSUB_SECRET: document.getElementById('ev_secret').value }; try{ const r=await fetch('/api/save-config',{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)}); const out=await r.json(); showMessage(out.message, out.success?'success':'error'); }catch(err){ showMessage('Error: '+err.message,'error'); } });

        // Recipes manager
        async function loadRecipes(){
            try{
                const res = await fetch('/api/recipes');
                const data = await res.json();
                const tbody = document.querySelector('#rc_table tbody');
                tbody.innerHTML = '';
                (data.data || []).forEach(r => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td><input data-k="title" data-id="${r.id}" value="${(r.title||'').replaceAll('"','&quot;')}"></td>
                        <td><input data-k="url" data-id="${r.id}" value="${(r.url||'').replaceAll('"','&quot;')}"></td>
                        <td><input data-k="description" data-id="${r.id}" value="${(r.description||'').replaceAll('"','&quot;')}"></td>
                        <td style="text-align:center;"><input type="checkbox" data-k="visible" data-id="${r.id}" ${r.visible?'checked':''}></td>
                        <td><input type="number" data-k="ord" data-id="${r.id}" value="${r.ord||0}" style="width:90px"></td>
                        <td style="text-align:center;">
                            <button class="btn" data-act="save" data-id="${r.id}">Save</button>
                            <button class="btn danger" data-act="del" data-id="${r.id}">Delete</button>
                        </td>`;
                    tbody.appendChild(tr);
                });
            } catch(e){ showMessage('Failed to load recipes: '+ e.message, 'error'); }
        }
        async function addRecipe(){
            const payload = {
                title: document.getElementById('rc_title').value.trim(),
                url: document.getElementById('rc_url').value.trim(),
                description: document.getElementById('rc_desc').value.trim(),
                ord: parseInt(document.getElementById('rc_ord').value||'0',10),
                visible: document.getElementById('rc_visible').value === 'true'
            };
            if(!payload.title){ showMessage('Title required', 'error'); return; }
            const res = await fetch('/api/recipes', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
            const out = await res.json();
            if(out.success){ showMessage('Recipe added','success'); document.getElementById('rc_title').value=''; document.getElementById('rc_url').value=''; document.getElementById('rc_desc').value=''; document.getElementById('rc_ord').value='0'; document.getElementById('rc_visible').value='true'; loadRecipes(); } else { showMessage(out.error||'Failed to add','error'); }
        }
        async function importBulk(){
            const txt = document.getElementById('rc_bulk').value.trim();
            if(!txt){ showMessage('Nothing to import', 'error'); return; }
            let data = null;
            if(txt.startsWith('[')){
                try{ data = JSON.parse(txt); }catch(e){ showMessage('Invalid JSON', 'error'); return; }
            }else{
                data = txt.split(/\r?\n/).map(line=>{
                    const parts = line.split('|');
                    return { title: (parts[0]||'').trim(), url: (parts[1]||'').trim(), description: (parts[2]||'').trim(), visible: true };
                }).filter(x=>x.title);
            }
            const res = await fetch('/api/recipes/bulk', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
            const out = await res.json();
            if(out.success){ showMessage(`Imported ${out.inserted} recipe(s)`, 'success'); document.getElementById('rc_bulk').value=''; loadRecipes(); } else { showMessage(out.error||'Failed to import','error'); }
        }
        function demoBulk(){
            const sample = [
                { title:'Classic Chocolate Chip Cookies', url:'https://www.allrecipes.com/recipe/10813/best-chocolate-chip-cookies/', description:'The ultimate comfort cookie' },
                { title:'Fluffy Pancakes', url:'https://www.kingarthurbaking.com/recipes/238-original-pancakes', description:'Perfect weekend breakfast treat' }
            ];
            document.getElementById('rc_bulk').value = JSON.stringify(sample, null, 2);
        }
        document.getElementById('rc_bulk_btn').addEventListener('click', importBulk);
        document.getElementById('rc_bulk_demo').addEventListener('click', demoBulk);

        // Initial
        function init(){ updateCallback(); }
        init();
    </script>
</body>
</html>