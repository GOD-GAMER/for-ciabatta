<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BakeBot - OAuth Wizard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #F5DEB3 0%, #D4A574 100%); padding: 20px; border-radius: 12px; margin-bottom: 20px; text-align: center; }
        .header h1 { color: #8B4513; font-size: 2.0em; margin-bottom: 8px; }
        .back-link { color: #8B4513; text-decoration: none; font-weight: bold; }
        .wizard-content { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #8B4513; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #D4A574; border-radius: 6px; font-size: 16px; }
        .btn { background: #D4A574; color: white; padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; }
        .message { padding: 12px; margin: 15px 0; border-radius: 6px; display: none; }
        .message.success { background: #d4edda; color: #155724; }
        .message.error { background: #f8d7da; color: #721c24; }
        .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OAuth Setup Wizard</h1>
            <a href="/" class="back-link">‚Üê Back to Dashboard</a>
        </div>
        <div class="wizard-content">
            <p>1) Create a Twitch application if you don't have one yet: <a href="https://dev.twitch.tv/console/apps" target="_blank">Twitch Developer Console</a></p>
            <p>2) Paste your Twitch Client ID:</p>
            <div class="form-group"><input id="client-id" placeholder="Client ID"></div>
            <p>3) Click "Open Auth". After you authorize, the token will be captured automatically and saved.</p>
            <div class="row">
                <button class="btn" id="btn-open-auth">Open Auth</button>
                <button class="btn" id="btn-copy-url" disabled>Copy URL</button>
            </div>
            <div class="form-group"><label>Auth URL</label><input id="oauth-url" readonly></div>
            <div id="msg" class="message"></div>
        </div>
    </div>

    <script>
        const msgEl = document.getElementById('msg');
        function showMsg(t, type='success'){ msgEl.textContent=t; msgEl.className=`message ${type}`; msgEl.style.display='block'; setTimeout(()=>msgEl.style.display='none', 4000); }
        function buildUrl(){
            const cid = document.getElementById('client-id').value.trim();
            if(!cid){ showMsg('Enter Client ID', 'error'); return null; }
            const redirect = encodeURIComponent('http://127.0.0.1:5000/oauth-callback');
            const scopes = encodeURIComponent('chat:read chat:edit');
            return `https://id.twitch.tv/oauth2/authorize?client_id=${cid}&redirect_uri=${redirect}&response_type=token&scope=${scopes}&force_verify=true`;
        }
        document.getElementById('btn-open-auth').addEventListener('click', function(){
            const u = buildUrl(); if(!u) return; document.getElementById('oauth-url').value = u; window.open(u, '_blank'); showMsg('Opened Twitch Auth. Complete it to auto-save your token.');
            document.getElementById('btn-copy-url').disabled = false;
        });
        document.getElementById('btn-copy-url').addEventListener('click', function(){ const el = document.getElementById('oauth-url'); el.select(); document.execCommand('copy'); showMsg('Auth URL copied'); });
        // If redirected here after capture
        const params = new URLSearchParams(location.search);
        if(params.get('captured')==='1'){ showMsg('Token captured and saved!', 'success'); }
        else if(params.get('captured')==='0'){ /* no-op */ }
    </script>
</body>
</html>